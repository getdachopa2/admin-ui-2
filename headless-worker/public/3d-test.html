<!DOCTYPE html>
<html>
<head>
    <title>3D-Secure SUAT Test</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background: #f1f1f1; }
        .form-group { margin-bottom: 15px; }
        .btn-row { margin: 20px 0; }
        .bank-buttons { margin: 20px 0; }
        .bank-buttons .btn { margin: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">3D-Secure SUAT Test</h1>
        
        <div class="bank-buttons">
            <button class="btn btn-danger" onclick="setBankInfo('Ak Bank','4355084355084358','12','26','000')">Ak Bank</button>
            <button class="btn btn-primary" onclick="setBankInfo('DenizBank','4090700090840057','11','22','592')">DenizBank</button>
            <button class="btn btn-success" onclick="setBankInfo('Garanti','4282209004348015','08','22','123')">Garanti</button>
            <button class="btn btn-warning" onclick="setBankInfo('HSBC','4282405990002166','12','20','000')">HSBC</button>
            <button class="btn btn-info" onclick="setBankInfo('Halk Bank','4029400140415945','06','20','136')">Halk Bank</button>
            <button class="btn btn-secondary" onclick="setBankInfo('Finans Bank','4022774022774026','12','19','000')">Finans Bank</button>
            <button class="btn btn-dark" onclick="setBankInfo('İş Bank','4508034508034509','12','19','000')">İş Bank</button>
        </div>

        <form id="paymentForm" class="mb-4">
            <div class="form-group">
                <label>Aktif Banka:</label>
                <input type="text" class="form-control" id="bankName" readonly>
            </div>

            <div class="form-group">
                <label>Card Number:</label>
                <input type="text" class="form-control" id="cardNumber" name="cardnumber">
            </div>
            
            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <label>Expire Month:</label>
                        <input type="text" class="form-control" id="expireMonth" name="cardexpiredatemonth">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label>Expire Year:</label>
                        <input type="text" class="form-control" id="expireYear" name="cardexpiredateyear">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label>CVV:</label>
                        <input type="text" class="form-control" id="cvv" name="cardCVV">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Cardholder Name:</label>
                <input type="text" class="form-control" id="cardHolderName" name="cardholdername" value="Kezban Mahmut">
            </div>

            <div class="form-group">
                <label>Amount:</label>
                <input type="text" class="form-control" id="amount" name="amount" value="100">
            </div>

            <div class="form-group">
                <label>Installment Count:</label>
                <input type="text" class="form-control" id="installmentCount" name="installmentCount" value="0">
            </div>

            <div class="form-check mb-3">
                <input type="checkbox" class="form-check-input" id="isPoint" name="isPoint">
                <label class="form-check-label">Is With Point</label>
            </div>

            <div class="form-group">
                <label>3D Session Id:</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="threeDSessionId" name="threeDSessionId">
                    <button class="btn btn-danger" type="button" onclick="document.getElementById('threeDSessionId').value=''">Temizle</button>
                    <button class="btn btn-primary" type="button" onclick="copySessionId()">Kopyala</button>
                </div>
            </div>

            <div class="btn-row">
                <button type="button" class="btn btn-info btn-lg" onclick="submitToEnv('stable')">
                    Bankaya Gonder (Stable)
                </button>
                <button type="button" class="btn btn-primary btn-lg" onclick="submitToEnv('preprod')">
                    Bankaya Gonder (PreProd)
                </button>
                <button type="button" class="btn btn-danger btn-lg" onclick="submitToEnv('prod')">
                    Bankaya Gonder (Prod)
                </button>
                <button type="button" class="btn btn-success btn-lg" onclick="submitToEnv('dev')">
                    Bankaya Gonder (Development)
                </button>
            </div>
        </form>

        <div class="card mt-4">
            <div class="card-header">Response</div>
            <div class="card-body">
                <pre id="response">No response yet...</pre>
            </div>
        </div>
    </div>

    <script>
        function setBankInfo(bank, cardNo, expMonth, expYear, cvv) {
            document.getElementById('bankName').value = bank;
            document.getElementById('cardNumber').value = cardNo;
            document.getElementById('expireMonth').value = expMonth;
            document.getElementById('expireYear').value = expYear;
            document.getElementById('cvv').value = cvv;
        }

        function copySessionId() {
            const sessionId = document.getElementById('threeDSessionId');
            sessionId.select();
            document.execCommand('copy');
        }

        function getEndpoint(env) {
            switch(env) {
                case 'stable':
                    return 'https://omccstb.turkcell.com.tr/paymentmanagement/rest/threeDSecure';
                case 'preprod':
                    return 'https://omccprp.turkcell.com.tr/paymentmanagement/rest/threeDSecure';
                case 'prod':
                    return 'https://epayment.turkcell.com.tr/paymentmanagement/rest/threeDSecure';
                case 'dev':
                    return 'http://localhost:7001/paymentmanagement/rest/threeDSecure';
                default:
                    return '/test/threeDSecure'; // local test endpoint
            }
        }

        function submitToEnv(env) {
            if (env === 'prod') {
                if (!confirm('PROD ortamına istek göndermek istediğinizden emin misiniz?')) {
                    return;
                }
            }

            const form = document.getElementById('paymentForm');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);
            
            // Log request details
            console.log('Sending request to:', getEndpoint(env));
            console.log('Request data:', data);

            fetch(getEndpoint(env), {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                document.getElementById('response').textContent = JSON.stringify(result, null, 2);
                if (result.threeDSessionId) {
                    document.getElementById('threeDSessionId').value = result.threeDSessionId;
                }
            })
            .catch(error => {
                document.getElementById('response').textContent = `Error: ${error.message}`;
            });
        }

        // Default to AkBank
        setBankInfo('Ak Bank', '4355084355084358', '12', '26', '000');
    </script>
</body>
</html>